

# キーワード
- 高可用性  
いつでもサービスを使えること．例えばコンビニは高可用性と言える．

- 縮退運転  
障害などが起こった時に規模を小さくして動かすこと．使うリソースを減らしたりするのもそれ．

- Fault Trerance  
障害寛容性．一部が壊れても継続して運用できること．

- 災害復旧 disaster recovery
災害が発生した際に，如何に早く復旧できるか，どこから復旧できるのかが問題となる．  
    - データセンターをまたいだ高可用性構成
    - 地域をまたいだ複製医
    - バックアップ

データセンターをまたぐタイプは可用性ゾーン  
地域をまたいだ複製はリージョンをまたいで数分おきにバックアップを取る  
バックアップは同一ゾーンに復旧できるバックアップをおいておく．復旧には時間がかかるが手軽

# コンピューティングリソース
- スケールアップ  
１台のスペックを上げる（コア数など）．スーパーでいうと１台のレジに担当する人数を増やす．分割できない重たい処理を回すのにはこちらが有効．サーバーの再起動が必要
- スケールアウト  
台数を増やす．並列実行に有効．スーパーでいうと複数台のレジを用意する．軽い処理を大量に回す時などに有効．配分等の調整がしやすい．スケールアウトはサーバーの再起動が不要．

azureには自動スケールアップやトリガー設定・メトリクス設定をしてスケールアップ，ダウンを自動で切り替える機能がある．すぐにON・OFFが切り替わらないようにスケールアップ後はしばらく条件が発動しないようにするクールダウン時間なども設定できる．

- アジリティ(agility)  
サーバーを追加したり削除したりするのに最低利用時間などがない．変化にすぐに対応できて，コストを最適化できる．


# コスト面
- 固定費，変動費を安く抑えられる．変動費は高く付きそうだけれども，自動スケールアップ等を最適化すると，一般的にはオンプレミスよりは安くなる，と言われているので安く抑えられるとおぼえておいて良い．  

- お金がかかるもの．ディスク，仮想マシン（割当解除で課金停止），ロードバランサー（Standardは無料)

# Iaas, Paas, SaaS
- IaaS  
インフラ as a Service．インフラだけ提供しているのでOSや仮想マシンは自分で設定して建てる．OSは設定済みのものも使えるがソフトなどは入ってない．
  - 既存システムの移行などに有効
- PaaS  
プラットフォーム as a Service．OS+Middleware．これだけだとわかりづらい．OSなどはすでにインストール済み，.NETやJavaなどをインストール済みでユーザはWebアプリを動かしたりするのに使ったり，コンテナを動かしたりするのに使う．設定はミドルウェアが提供するAPIなどを介して行う．
  - 例：Webアプリ．
      - ミドルウェア  Javaとか.NET
      - OS Windows Linux
      - リージョン　任意
      - 仮想マシンのサイズ  任意
　- OSのアップデートや修正パッチも自動で当ててくれる．

- SaaS
Software as a Service. Microsoft 365(Excel, PowerPointとか)などアプリケーションを提供する．当然，OSの設定などはできない.こちらのほとんどは時間制課金じゃなくてライセンス単位の課金となる

# パブリッククラウド，プライベートクラウド，ハイブリットクラウド
- パブリッククラウド  
誰でも使用可能なクラウド．一般的にはこれ

- プライベートクラウド  
特定企業のみに提供する物理的なマシンをクラウドと見立てて使用したり，オンプレミスをクラウドの仕組みで使えるようにしたりする．セキュリティ上の問題や，社内ルールでパブリッククラウドが使えない場合に利用する

- ハイブリットクラウド
一部のシステムはパブリックで使うが，社内ルール的に一部はプライベートで使わなければならない時，こういう時に使う

C
B
BD
A
B
A
A
A
C
B
AAAAaaaAAAAAAAaaaaaqqwww```

# 可用性のSLA
２台の仮想マシンだと99.95%
２台以上の仮想マシンを２つ以上の可用性ゾーンに展開すると99.99%


# 更新ドメイン
OSのアップデートは物理マシンの再起動が必要となる，
その場合，運用しているサービスは可用性の範囲で切り替えて使いたい．
そこで，更新をかけるマシンをドメインでまとめることで同時に落ちないようにできる．
例えばドメイン１とドメイン２に更新ドメインがわかれていれば同時に落ちることはなくなる．
可用性セットで用意される更新ドメインは基本５つ．

# 障害ドメイン
ラックをドメイン管理．ラック単位で障害が起きた際に障害ドメインをわけておけばサービスの可用性があがる．

# 可用性セットは同じデータセンター内部で展開される
そのため，データセンター全体の障害はダメ．可用性ゾーン，可用性リージョンをわけよう．
可用性セットはあくまで物理的な障害に対する可用性向上を目的とする．

# コンテナ
- 仮想マシンはHyper-Vのコンテナを使っている．これはハイパーバイザ上で各々のOSが別個に動いている

- LinuxはDockerコンテナを使っている．これは１つのOSに複数のコンテナが動作する

- Azureのコンテナイメージの保存場所はACR `Azure Container Registry`を使用している

- コンテナを動作させる仕組みのことをAzure Container Instancesと呼ぶ(ACI)

## なぜ(Linux)Containerを使うか?
- VMを動かしてサービスを動かす場合，サービスの再起動が必要な時にOSの再起動となるが，動作が遅い．それに比べてコンテナは再起動が早い
- １サービス１OSではリソースの効率が悪い．コンテナは１つのOS上で複数のコンテナ（サービス）を動作可能で，更にお互いに環境に影響を与えないためリソースの使い方が効率的である

# Azure Kubernetes Service  (AKS)
Googleの開発したK8s(Kubernetes)をAzure上で動作するようにしたもの．  
Containerを直接コマンドで操作，管理するよりも，k8sを使って管理したほうが効率的・賢く管理できる．k8sはコンテナのオーケストレーションサービス．スケールアウトなどを自動調節してくれる．


# ネットワーク技術  
## Azure Virtual Network(AVNET)
仮想ネットワーク．仮想マシン同士をあたかもネットワークがあるかのようにして接続したりアクセスしたりする．サブネットなどで分離して管理．  
`システムルート`が自動ルーティングしてくれる．  
異なるサブネットなど，仮想ネットワーク同士を通信させるには`ピアリング(直接通信)`させる必要がある．`ピアリング`させるには予めサブネットを異なるものにしておく必要がある(1.10.0.0同士だとできないので1.10.0.0と1.11.0.0に設定しておく)  
  
- ネットワーク仮想アプライアンス(NVA)
    - 複数のネットワークカードを持った仮想マシンを作成し，サブネット間のルーティング機能とセキュリティフィルター機能を構成する
- ユーザ定義ルート(UDR)  
    - NVAのルーティング機能を使うために，システムルートよりも優先度の高いルートを定義する．システムルートを直接変更したり削除したりはできない．UDRの優先度を上げることでSRではないルーティングを実現する

## VPNゲートウェイ
デフォルトだと社内ネットワークと仮想ネットワークとはつながっていない（ので，Azureに直接アクセスできない)．でも，オンプレミスのサービスとの連携や外部ネットワーク経由でファイルをアップロードしたくないなどVPNでつなげたい場合がある．  
そのための機能として仮想ネットワークにゲートウェイ用サブネット(ゲートウェイサブネット)を作成し，VPNゲートウェイを追加する．  





